<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StableGuard æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        button:hover {
            background: #45a049;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 6px;
            border-left: 4px solid #4CAF50;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
        }
        .error {
            border-left-color: #f44336;
            background: #ffebee;
        }
        .warning {
            border-left-color: #ff9800;
            background: #fff3e0;
        }
        .info {
            border-left-color: #2196F3;
            background: #e3f2fd;
        }
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        .status.success { background: #4CAF50; color: white; }
        .status.error { background: #f44336; color: white; }
        .status.pending { background: #ff9800; color: white; }
    </style>
</head>
<body>
    <h1>ğŸ›¡ï¸ StableGuard åŠŸèƒ½æµ‹è¯•</h1>
    <p>è¿™ä¸ªé¡µé¢ç”¨äºæµ‹è¯• MatrixLabs Wallet çš„ StableGuard åŠŸèƒ½</p>

    <!-- Test 1: Check Extension -->
    <div class="card">
        <h2>1. æ£€æŸ¥æ‰©å±•æ˜¯å¦å®‰è£… <span id="status1" class="status pending">ç­‰å¾…æµ‹è¯•</span></h2>
        <button onclick="testExtension()">å¼€å§‹æµ‹è¯•</button>
        <div id="result1" class="result" style="display:none;"></div>
    </div>

    <!-- Test 2: Trigger Risk Assessment -->
    <div class="card">
        <h2>2. è§¦å‘é£é™©è¯„ä¼° <span id="status2" class="status pending">ç­‰å¾…æµ‹è¯•</span></h2>
        <button onclick="triggerAssessment()">è§¦å‘è¯„ä¼°</button>
        <div id="result2" class="result" style="display:none;"></div>
    </div>

    <!-- Test 3: Check Risk Data -->
    <div class="card">
        <h2>3. æŸ¥çœ‹é£é™©æ•°æ® <span id="status3" class="status pending">ç­‰å¾…æµ‹è¯•</span></h2>
        <button onclick="checkRiskData()">æŸ¥çœ‹æ•°æ®</button>
        <div id="result3" class="result" style="display:none;"></div>
    </div>

    <!-- Test 4: Test Transaction -->
    <div class="card">
        <h2>4. æ¨¡æ‹Ÿç¨³å®šå¸äº¤æ˜“ <span id="status4" class="status pending">ç­‰å¾…æµ‹è¯•</span></h2>
        <p style="color: #666; font-size: 14px;">
            è¿™å°†æ¨¡æ‹Ÿä¸€ç¬” USDT è½¬è´¦ï¼Œæµ‹è¯• StableGuard æ˜¯å¦ä¼šæ‹¦æˆªå¹¶è¯„ä¼°
        </p>
        <button onclick="testTransaction()">æ¨¡æ‹Ÿäº¤æ˜“</button>
        <div id="result4" class="result" style="display:none;"></div>
    </div>

    <!-- Instructions -->
    <div class="card" style="background: #e3f2fd;">
        <h3>ğŸ“ ä½¿ç”¨è¯´æ˜</h3>
        <ol>
            <li>ç¡®ä¿å·²å®‰è£… MatrixLabs Wallet æ‰©å±•</li>
            <li>ç¡®ä¿é’±åŒ…å·²è§£é”</li>
            <li>æŒ‰é¡ºåºç‚¹å‡»æµ‹è¯•æŒ‰é’®</li>
            <li>æŸ¥çœ‹ Background DevTools çš„ Console è¾“å‡º</li>
        </ol>
    </div>

    <script>
        // Test 1: Check if extension is installed
        async function testExtension() {
            const resultDiv = document.getElementById('result1');
            const statusSpan = document.getElementById('status1');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'æ­£åœ¨æ£€æŸ¥æ‰©å±•...';

            try {
                // Try to detect if window.ethereum exists (injected by wallet)
                if (typeof window.ethereum !== 'undefined') {
                    resultDiv.className = 'result';
                    resultDiv.textContent = 'âœ… æ£€æµ‹åˆ°é’±åŒ…æ‰©å±•ï¼\n\n' +
                        'Provider: ' + (window.ethereum.isMatrixLabs ? 'MatrixLabs Wallet' : 'Unknown') + '\n' +
                        'Chain ID: ' + (window.ethereum.chainId || 'Unknown');
                    statusSpan.className = 'status success';
                    statusSpan.textContent = 'é€šè¿‡';
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = 'âŒ æœªæ£€æµ‹åˆ°é’±åŒ…æ‰©å±•\n\nè¯·ç¡®ä¿ï¼š\n1. å·²å®‰è£… MatrixLabs Wallet\n2. å·²åˆ·æ–°æ­¤é¡µé¢';
                    statusSpan.className = 'status error';
                    statusSpan.textContent = 'å¤±è´¥';
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = 'âŒ æµ‹è¯•å‡ºé”™ï¼š' + error.message;
                statusSpan.className = 'status error';
                statusSpan.textContent = 'é”™è¯¯';
            }
        }

        // Test 2: Trigger risk assessment
        async function triggerAssessment() {
            const resultDiv = document.getElementById('result2');
            const statusSpan = document.getElementById('status2');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'æ­£åœ¨è§¦å‘é£é™©è¯„ä¼°...\n\nè¯·æŸ¥çœ‹ Background DevTools Console';

            try {
                // This will trigger when user opens the wallet
                // We can't directly call background scripts from web page
                resultDiv.className = 'result warning';
                resultDiv.textContent = 'âš ï¸ æ— æ³•ä»ç½‘é¡µç›´æ¥è§¦å‘è¯„ä¼°\n\n' +
                    'è¯·æ‰‹åŠ¨æ“ä½œï¼š\n' +
                    '1. æ‰“å¼€é’±åŒ…æ‰©å±•\n' +
                    '2. è¿›å…¥ Home é¡µé¢\n' +
                    '3. ç‚¹å‡» StableGuard å¾½ç« \n' +
                    '4. ç‚¹å‡»åˆ·æ–°æŒ‰é’®\n\n' +
                    'ç„¶åæŸ¥çœ‹ Background Console è¾“å‡ºï¼š\n' +
                    '[StableGuard] Starting risk assessment...\n' +
                    '[DataAgent] Starting data collection...\n' +
                    '[StableGuard] Assessment completed';
                statusSpan.className = 'status pending';
                statusSpan.textContent = 'éœ€æ‰‹åŠ¨';
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = 'âŒ é”™è¯¯ï¼š' + error.message;
                statusSpan.className = 'status error';
                statusSpan.textContent = 'é”™è¯¯';
            }
        }

        // Test 3: Check risk data (via Chrome Storage API - won't work from web page)
        async function checkRiskData() {
            const resultDiv = document.getElementById('result3');
            const statusSpan = document.getElementById('status3');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'æ­£åœ¨æŸ¥è¯¢é£é™©æ•°æ®...';

            try {
                // Web pages can't access chrome.storage
                resultDiv.className = 'result warning';
                resultDiv.textContent = 'âš ï¸ æ— æ³•ä»ç½‘é¡µè®¿é—® Chrome Storage\n\n' +
                    'è¯·åœ¨ Background DevTools Console ä¸­æ‰§è¡Œï¼š\n\n' +
                    'chrome.storage.local.get([\n' +
                    '  "stableguard_risk_usdt",\n' +
                    '  "stableguard_risk_usdc",\n' +
                    '  "stableguard_risk_dai",\n' +
                    '  "stableguard_last_update"\n' +
                    '], (result) => {\n' +
                    '  console.log("StableGuard Data:", result);\n' +
                    '});';
                statusSpan.className = 'status pending';
                statusSpan.textContent = 'éœ€æ‰‹åŠ¨';
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = 'âŒ é”™è¯¯ï¼š' + error.message;
                statusSpan.className = 'status error';
                statusSpan.textContent = 'é”™è¯¯';
            }
        }

        // Test 4: Test transaction
        async function testTransaction() {
            const resultDiv = document.getElementById('result4');
            const statusSpan = document.getElementById('status4');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'æ­£åœ¨å‡†å¤‡äº¤æ˜“...';

            try {
                if (typeof window.ethereum === 'undefined') {
                    throw new Error('æœªæ£€æµ‹åˆ°é’±åŒ…æ‰©å±•');
                }

                // Request accounts
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                
                if (!accounts || accounts.length === 0) {
                    throw new Error('æœªè·å–åˆ°è´¦æˆ·');
                }

                // USDT contract address on Ethereum mainnet
                const usdtAddress = '0xdAC17F958D2ee523a2206206994597C13D831ec7';
                
                // Prepare transaction (won't actually send)
                const txParams = {
                    from: accounts[0],
                    to: usdtAddress,
                    value: '0x0',
                    data: '0xa9059cbb' + // transfer function signature
                          '000000000000000000000000' + accounts[0].substring(2) + // to address
                          '0000000000000000000000000000000000000000000000000000000000000064' // amount (100 in hex)
                };

                resultDiv.className = 'result';
                resultDiv.textContent = 'âœ… äº¤æ˜“å·²å‡†å¤‡\n\n' +
                    'äº¤æ˜“è¯¦æƒ…ï¼š\n' +
                    'From: ' + accounts[0] + '\n' +
                    'To: ' + usdtAddress + ' (USDT)\n' +
                    'Function: transfer()\n\n' +
                    'âš ï¸ æ³¨æ„ï¼šè¿™åªæ˜¯å‡†å¤‡äº¤æ˜“ï¼Œä¸ä¼šå®é™…å‘é€\n\n' +
                    'è¦æµ‹è¯• StableGuardï¼š\n' +
                    '1. åœ¨é’±åŒ…ä¸­å‘èµ·ä¸€ç¬”çœŸå®çš„ USDT è½¬è´¦\n' +
                    '2. è§‚å¯Ÿç¡®è®¤é¡µé¢æ˜¯å¦æ˜¾ç¤ºé£é™©æç¤º\n' +
                    '3. æŸ¥çœ‹ Background Console çš„è¯„ä¼°æ—¥å¿—';
                statusSpan.className = 'status success';
                statusSpan.textContent = 'å·²å‡†å¤‡';

            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = 'âŒ é”™è¯¯ï¼š' + error.message + '\n\n' +
                    'å¯èƒ½çš„åŸå› ï¼š\n' +
                    '1. é’±åŒ…æœªè¿æ¥\n' +
                    '2. ç”¨æˆ·æ‹’ç»è¿æ¥\n' +
                    '3. é’±åŒ…æœªè§£é”';
                statusSpan.className = 'status error';
                statusSpan.textContent = 'å¤±è´¥';
            }
        }

        // Auto-run first test on page load
        window.addEventListener('load', () => {
            setTimeout(testExtension, 500);
        });
    </script>
</body>
</html>
