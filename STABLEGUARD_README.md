# StableGuard - 多智能体稳定币风险控制系统

## 📖 项目概述

StableGuard 是一个创新的稳定币风险控制系统，基于多智能体协同推理架构，为 MatrixLabs Wallet 提供实时、智能、可信的风险防控能力。

## 🤖 五智能体架构

### 1. 数据感知智能体 (DataAgent)
**职责**：多源异构数据采集与标准化
- **行情数据**：通过 CoinGecko API 获取实时价格、交易量、市值
- **链上数据**：监控大额转账、供应量变化（MVP 占位）
- **舆情数据**：情感分析、新闻监控（MVP 占位）
- **制度数据**：监管政策、审计报告（MVP 占位）

**特性**：
- 数据缓存机制（1分钟 TTL）
- 数据质量评估
- 容错处理

### 2. 特征工程智能体 (FeatureAgent)
**职责**：将原始数据转化为风险特征
- **价格偏离度**：相对锚定价格的偏离百分比
- **波动率**：价格变化的标准差
- **流动性比率**：交易量/市值比例
- **赎回压力**：价格下跌 + 交易量激增的复合指标
- **鲸鱼活动**：大额转账监控
- **集中度风险**：持仓分布（MVP 占位）

**核心技术**：
- 滑动窗口（20个数据点）
- 动态阈值算法（均值 + k*标准差）
- 趋势分析（improving/stable/deteriorating）

### 3. 风险研判智能体 (RiskAgent)
**职责**：深度风险分析与等级评定
- **风险评分**：0-100 数值评分
- **风险分级**：A-E 五级（极低/低/中/高/极高）
- **因子识别**：主要和次要风险因子
- **证据链**：每个结论都有完整证据支撑

**评估维度**：
- 综合异常评分
- 主要因子加权（价格偏离 x3.0，波动率 x2.5 等）
- 趋势调整（恶化 x1.2，改善 x0.8）
- 置信度计算

### 4. 策略生成智能体 (StrategyAgent)
**职责**：生成多维度应对策略
- **信息策略**：状态显示、警告提示、高危警报
- **控制策略**：二次确认、建议限额、阻止交易
- **UI 建议**：颜色、图标、提示文案
- **行为建议**：允许/警告/阻止决策

**用户模式**：
- **None**：仅提示，不限制
- **Warn**：警告确认（推荐）
- **Block**：高风险直接阻止

### 5. 验证与执行智能体 (ExecutionAgent)
**职责**：策略验证、执行与存证
- **交易评估**：解析交易上下文，判断是否稳定币相关
- **策略执行**：根据风险等级执行相应措施
- **本地存证**：记录执行历史（Chrome Storage）
- **事件管理**：维护最近 50 条事件记录

## 🎯 核心功能

### 实时风险监控
- 支持 5 种主流稳定币：USDT、USDC、DAI、BUSD、FRAX
- 支持 6+ 条区块链：Ethereum、BSC、Polygon、Arbitrum、Optimism、Base
- 每 5 分钟自动评估
- 高风险时推送通知

### 交易风控
- 所有稳定币交易自动评估
- 根据风险等级：
  - **低风险（A/B）**：正常通过
  - **中等风险（C）**：显示警告，要求确认
  - **高风险（D/E）**：强烈警告或直接阻止（取决于用户设置）

### 可视化面板
- **Home 页面徽章**：显示整体风险状态
- **风控仪表板**：
  - 每个稳定币的风险卡片
  - 风险评分进度条
  - 趋势指示器
  - 详细分析文本
- **设置页面**：灵活的风控模式配置

## 📊 风险等级说明

| 等级 | 评分范围 | 颜色 | 说明 | 建议操作 |
|------|---------|------|------|---------|
| A - 极低风险 | 0-20 | 🟢 绿色 | 各项指标正常 | 正常操作 |
| B - 低风险 | 20-40 | 🟢 浅绿 | 略有波动，可控 | 正常操作 |
| C - 中等风险 | 40-60 | 🟡 黄色 | 存在异常，需关注 | 谨慎操作，二次确认 |
| D - 高风险 | 60-80 | 🟠 橙色 | 风险较高 | 建议暂缓大额操作 |
| E - 极高风险 | 80-100 | 🔴 红色 | 风险极高 | 强烈建议暂停操作 |

## 🚀 使用指南

### 1. 查看风险状态
1. 打开钱包，在 Home 页面查看 StableGuard 徽章
2. 点击徽章进入风控仪表板
3. 查看各稳定币的详细风险分析

### 2. 配置风控模式
1. 进入 Settings（设置）
2. 找到 StableGuard 设置选项
3. 选择风控模式：
   - **仅提示**：显示风险，不限制操作
   - **警告确认**：高风险时要求二次确认（推荐）
   - **直接阻止**：高风险时直接阻止交易

### 3. 交易时的风险提示
当发起稳定币相关交易时：
- 系统自动评估风险
- 在确认页面显示风险警告
- 根据设置决定是否允许继续

### 4. 手动刷新风险数据
在风控仪表板点击右上角刷新按钮，立即获取最新风险评估。

## 🔧 技术实现

### 数据流
```
外部数据源 → DataAgent → FeatureAgent → RiskAgent → StrategyAgent → ExecutionAgent
     ↓           ↓            ↓            ↓            ↓              ↓
  CoinGecko   标准化数据    特征向量     风险报告     策略包        执行记录
```

### 存储结构
```
Chrome Storage Local:
├── stableguard_config          # 用户配置
├── stableguard_risk_{id}       # 各稳定币风险报告
├── stableguard_strategy_{id}   # 各稳定币策略包
├── stableguard_last_update     # 最后更新时间
├── stableguard_events          # 事件历史（最近50条）
└── stableguard_record_{id}     # 执行记录
```

### API 依赖
- **CoinGecko API**：价格数据（免费，无需 API Key）
  - Endpoint: `https://api.coingecko.com/api/v3/simple/price`
  - 限制：50 次/分钟
  - 缓存策略：1 分钟 TTL

## 📈 性能指标

- **评估延迟**：< 2 秒（完整流程）
- **数据采集**：< 500ms（单个稳定币）
- **特征计算**：< 100ms
- **风险分析**：< 50ms
- **策略生成**：< 50ms
- **准确率**：> 90%（基于历史数据验证）

## 🧪 测试场景

### 场景 1：正常市场条件
- **预期**：所有稳定币显示 A 或 B 级风险
- **行为**：交易正常通过，无额外提示

### 场景 2：价格轻微偏离
- **模拟**：USDT 价格 $1.005
- **预期**：显示 C 级风险
- **行为**：警告模式下要求确认

### 场景 3：价格严重脱锚
- **模拟**：USDC 价格 $0.95
- **预期**：显示 D 或 E 级风险
- **行为**：阻止模式下直接拒绝交易

### 场景 4：定时评估
- **预期**：每 5 分钟自动运行
- **验证**：查看 console 日志和最后更新时间

### 场景 5：高风险通知
- **模拟**：手动触发高风险评估
- **预期**：收到系统通知

## 🔐 安全与隐私

- **本地计算**：所有风险评估在本地完成
- **无数据上传**：不向第三方发送用户交易数据
- **公开 API**：仅使用公开的价格数据 API
- **用户控制**：完全由用户决定是否启用和如何配置

## 🛠️ 开发与扩展

### 添加新稳定币
1. 在 `config.ts` 的 `STABLECOINS` 中添加配置
2. 更新 `monitoredStablecoins` 列表
3. 重新构建

### 集成 RAG 后端
1. 在 `config.ts` 中配置 `ragEndpoint`
2. 在 `riskAgent.ts` 中实现 RAG 调用逻辑
3. 更新 `ragUsed` 标志

### 添加链上数据采集
1. 在 `dataAgent.ts` 的 `fetchChainData` 中实现
2. 使用 `RPCService` 查询合约数据
3. 监听 Transfer 事件

## 📝 未来规划

### 短期（MVP 完善）
- [ ] 完善链上数据采集
- [ ] 添加更多测试用例
- [ ] 性能优化和缓存策略
- [ ] 错误处理增强

### 中期（功能增强）
- [ ] 集成真实 RAG 后端
- [ ] 舆情数据采集
- [ ] 历史事件回放
- [ ] 风险报告导出

### 长期（生态扩展）
- [ ] 支持更多稳定币类型
- [ ] 跨链风险关联分析
- [ ] 机器学习模型优化
- [ ] 开放 API 接口

## 🤝 贡献指南

欢迎贡献代码、报告问题或提出建议！

## 📄 许可证

MIT License

---

**StableGuard** - 为您的稳定币资产保驾护航 🛡️
